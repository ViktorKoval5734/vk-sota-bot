#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¾Ñ‚Ð° Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð° Ð² Ð¾Ð´Ð½Ð¾Ð¼ Ð¾ÐºÐ½Ðµ Konsole
# Ñ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸ÐµÐ¼ (Ð´Ð²Ðµ Ð¿Ð°Ð½ÐµÐ»Ð¸ Ñ€ÑÐ´Ð¾Ð¼)

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð¡Ð¾Ñ‚Ð° Ð¡Ð¸Ð» Ð² Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ Ñ€Ð°Ð·Ð´ÐµÐ»Ñ‘Ð½Ð½Ð¾Ð¼ Ð¾ÐºÐ½Ðµ Konsole..."

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð»Ð¸ Konsole
if ! command -v konsole &> /dev/null; then
    echo "âŒ Konsole Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. Ð­Ñ‚Ð¾Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² KDE/Plasma."
    echo "ðŸ’¡ ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð°: Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ./run_sota.sh (tmux)"
    exit 1
fi

cd /home/deck/vk_sota_bot

echo "ðŸ“ ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ð¼ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ: /home/deck/vk_sota_bot"

# Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð² Ñ€Ð°Ð·Ð´ÐµÐ»Ñ‘Ð½Ð½Ð¾Ð¼ Ð¾ÐºÐ½Ðµ
TEMP_SCRIPT=$(mktemp)

cat > "$TEMP_SCRIPT" << 'EOF'
# Ð–Ð´Ñ‘Ð¼ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð´Ð»Ñ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Konsole
sleep 1

# Ð Ð°Ð·Ð´ÐµÐ»ÑÐµÐ¼ Ð¾ÐºÐ½Ð¾ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ (Ctrl+Shift+O)
sleep 0.5
# ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ñ Ð¾ÐºÐ½Ð°
# Ð’ Konsole: Ctrl+Shift+O Ð´Ð»Ñ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ñ
# Ð—Ð°Ñ‚ÐµÐ¼ Ctrl+Tab Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¼ÐµÐ¶Ð´Ñƒ Ð¿Ð°Ð½ÐµÐ»ÑÐ¼Ð¸

# Ð’ Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ð¿Ð°Ð½ÐµÐ»Ð¸ (Ð»ÐµÐ²Ð¾Ð¹) Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð±Ð¾Ñ‚Ð°
echo "ðŸ¤– Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð° Ð¡Ð¾Ñ‚Ð° Ð¡Ð¸Ð»..."
echo "ðŸ“¡ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ..."
python bot.py

# ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð±Ð¾Ñ‚Ð° Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ HTTP ÑÐµÑ€Ð²ÐµÑ€ Ð² ÑÑ‚Ð¾Ð¹ Ð¶Ðµ Ð¿Ð°Ð½ÐµÐ»Ð¸
# (ÐµÑÐ»Ð¸ Ð±Ð¾Ñ‚ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð»ÑÑ)
echo ""
echo "ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº HTTP ÑÐµÑ€Ð²ÐµÑ€Ð°..."
python -m http.server 8080
EOF

# Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð¿Ð°Ð½ÐµÐ»Ð¸
TEMP_SCRIPT2=$(mktemp)

cat > "$TEMP_SCRIPT2" << 'EOF'
# Ð–Ð´Ñ‘Ð¼ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸
sleep 1

# ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ Ð²Ð¾ Ð²Ñ‚Ð¾Ñ€ÑƒÑŽ Ð¿Ð°Ð½ÐµÐ»ÑŒ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
sleep 0.5

# Ð’Ð¾ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð¿Ð°Ð½ÐµÐ»Ð¸ (Ð¿Ñ€Ð°Ð²Ð¾Ð¹) Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ HTTP ÑÐµÑ€Ð²ÐµÑ€ ÑÑ€Ð°Ð·Ñƒ
echo "ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº HTTP ÑÐµÑ€Ð²ÐµÑ€Ð°..."
echo "ðŸ“ Ð¡ÐµÑ€Ð²ÐµÑ€ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ: http://localhost:8080"
echo "ðŸ›‘ Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"
echo ""
python -m http.server 8080
EOF

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Konsole Ñ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸ÐµÐ¼
echo "ðŸ–¥ï¸ ÐžÑ‚ÐºÑ€Ñ‹Ð²Ð°ÑŽ Ð¾ÐºÐ½Ð¾ Konsole Ñ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸ÐµÐ¼..."

# Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ ÑÐºÑ€Ð¸Ð¿Ñ‚, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¾Ñ‚ÐºÑ€Ð¾ÐµÑ‚ Konsole Ð¸ Ñ€Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ ÐµÐ³Ð¾
FINAL_SCRIPT=$(mktemp)

cat > "$FINAL_SCRIPT" << 'EOF'
# Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ð½Ð¾Ð²Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Konsole
konsole --separate --new-tab \
  --title "Ð¡Ð¾Ñ‚Ð° Ð¡Ð¸Ð» - Ð Ð°Ð·Ð´ÐµÐ»Ñ‘Ð½Ð½Ð¾Ðµ Ð¾ÐºÐ½Ð¾" \
  --workdir /home/deck/vk_sota_bot \
  -e bash -c "
    echo 'ðŸš€ Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ€Ð°Ð·Ð´ÐµÐ»Ñ‘Ð½Ð½Ð¾Ð³Ð¾ Ð¾ÐºÐ½Ð°...'
    sleep 1
    
    # Ð Ð°Ð·Ð´ÐµÐ»ÑÐµÐ¼ Ð¾ÐºÐ½Ð¾ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ (Ð² Konsole: Ctrl+Shift+O)
    # ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Ð´Ð»Ñ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ñ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð°Ñ‚ÑŒÑÑ Ð² Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð²ÐµÑ€ÑÐ¸ÑÑ…
    
    echo 'ðŸ¤– Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð° Ð² Ð»ÐµÐ²Ð¾Ð¹ Ð¿Ð°Ð½ÐµÐ»Ð¸...'
    echo 'ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº HTTP ÑÐµÑ€Ð²ÐµÑ€Ð° Ð² Ð¿Ñ€Ð°Ð²Ð¾Ð¹ Ð¿Ð°Ð½ÐµÐ»Ð¸...'
    
    # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð±Ð¾Ñ‚Ð° Ð² Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ð¿Ð°Ð½ÐµÐ»Ð¸
    python bot.py
  " &

# Ð–Ð´Ñ‘Ð¼ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð¾ÐºÐ½Ð°
sleep 3

# ÐžÑ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð²Ñ‚Ð¾Ñ€ÑƒÑŽ Ð¿Ð°Ð½ÐµÐ»ÑŒ/Ð²ÐºÐ»Ð°Ð´ÐºÑƒ Ð´Ð»Ñ HTTP ÑÐµÑ€Ð²ÐµÑ€Ð°
konsole --separate --new-tab \
  --title "HTTP Ð¡ÐµÑ€Ð²ÐµÑ€" \
  --workdir /home/deck/vk_sota_bot \
  -e bash -c "
    echo 'ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº HTTP ÑÐµÑ€Ð²ÐµÑ€Ð°...'
    echo 'ðŸ“ Ð¡ÐµÑ€Ð²ÐµÑ€ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½: http://localhost:8080'
    python -m http.server 8080
  " &

echo "âœ… ÐžÐºÐ½Ð° Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹!"
EOF

chmod +x "$FINAL_SCRIPT"
bash "$FINAL_SCRIPT"

# Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
rm -f "$TEMP_SCRIPT" "$TEMP_SCRIPT2" "$FINAL_SCRIPT"

echo ""
echo "ðŸ“‹ Ð—Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÐ½Ð°:"
echo "   ðŸ¤– Ð’ÐºÐ»Ð°Ð´ÐºÐ° 1: Ð‘Ð¾Ñ‚ Ð¡Ð¾Ñ‚Ð° Ð¡Ð¸Ð»"
echo "   ðŸŒ Ð’ÐºÐ»Ð°Ð´ÐºÐ° 2: HTTP ÑÐµÑ€Ð²ÐµÑ€ (Ð¿Ð¾Ñ€Ñ‚ 8080)"
echo ""
echo "ðŸ”§ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð² Konsole:"
echo "   - ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¼ÐµÐ¶Ð´Ñƒ Ð²ÐºÐ»Ð°Ð´ÐºÐ°Ð¼Ð¸: Ctrl+Tab Ð¸Ð»Ð¸ Ctrl+Shift+N"
echo "   - Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ: Ctrl+Shift+W"
echo "   - Ð Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¾ÐºÐ½Ð¾: Ctrl+Shift+O (Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾) Ð¸Ð»Ð¸ Ctrl+Shift+E (Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ð¾)"
echo ""
echo "ðŸ“ Ð›Ð¾Ð³Ð¸ Ð±Ð¾Ñ‚Ð° Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ Ð² Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ÐºÐµ"
echo "ðŸŒ Ð’ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ: http://localhost:8080"